{% extends 'base.html' %}
{% block content %}
<div class="card bg-light mb-4 shadow-sm">
  <div class="card-body">
    <h2 class="card-title mb-3"><i class="fas fa-tachometer-alt"></i> Bank Dashboard</h2>
    <p class="card-text text-muted">Real-time overview of bank account balance, transactions, and reconciliation status</p>
  </div>
</div>

<!-- Key Metrics -->
<div class="row mb-4">
  <div class="col-md-3">
    <div class="card text-center bg-gradient-primary text-white h-100">
      <div class="card-body">
        <h6 class="card-title text-uppercase small mb-3">Closing Balance</h6>
        <h2 class="mb-0">Rs. {{ "%.2f"|format(summary.closing_balance) }}</h2>
        <small class="text-white-50">Current Balance</small>
      </div>
    </div>
  </div>
  
  <div class="col-md-3">
    <div class="card text-center bg-success text-white h-100">
      <div class="card-body">
        <h6 class="card-title text-uppercase small mb-3">Total Credits</h6>
        <h2 class="mb-0">Rs. {{ "%.2f"|format(summary.total_credit) }}</h2>
        <small class="text-white-50">Money Received</small>
      </div>
    </div>
  </div>
  
  <div class="col-md-3">
    <div class="card text-center bg-danger text-white h-100">
      <div class="card-body">
        <h6 class="card-title text-uppercase small mb-3">Total Debits</h6>
        <h2 class="mb-0">Rs. {{ "%.2f"|format(summary.total_debit) }}</h2>
        <small class="text-white-50">Money Paid Out</small>
      </div>
    </div>
  </div>
  
  <div class="col-md-3">
    <div class="card text-center bg-info text-white h-100">
      <div class="card-body">
        <h6 class="card-title text-uppercase small mb-3">Opening Balance</h6>
        <h2 class="mb-0">Rs. {{ "%.2f"|format(summary.opening_balance) }}</h2>
        <small class="text-white-50">Period Start</small>
      </div>
    </div>
  </div>
</div>

<!-- Reconciliation Status -->
<div class="row mb-4">
  <div class="col-md-6">
    <div class="card">
      <div class="card-header bg-info text-white">
        <h5 class="mb-0"><i class="fas fa-check-circle"></i> Cleared Transactions</h5>
      </div>
      <div class="card-body">
        <div class="row text-center">
          <div class="col">
            <h3 class="text-success">+Rs. {{ "%.2f"|format(reconciliation.cleared_credits) }}</h3>
            <small class="text-muted">Credits Cleared</small>
          </div>
          <div class="col">
            <h3 class="text-danger">-Rs. {{ "%.2f"|format(reconciliation.cleared_debits) }}</h3>
            <small class="text-muted">Debits Cleared</small>
          </div>
          <div class="col">
            <h4 class="text-primary">{{ reconciliation.cleared_count }}</h4>
            <small class="text-muted">Transactions</small>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-md-6">
    <div class="card">
      <div class="card-header bg-warning text-dark">
        <h5 class="mb-0"><i class="fas fa-hourglass"></i> Pending Transactions</h5>
      </div>
      <div class="card-body">
        <div class="row text-center">
          <div class="col">
            <h3 class="text-success">+Rs. {{ "%.2f"|format(reconciliation.pending_credits) }}</h3>
            <small class="text-muted">Credits Pending</small>
          </div>
          <div class="col">
            <h3 class="text-danger">-Rs. {{ "%.2f"|format(reconciliation.pending_debits) }}</h3>
            <small class="text-muted">Debits Pending</small>
          </div>
          <div class="col">
            <h4 class="text-warning">{{ reconciliation.pending_count }}</h4>
            <small class="text-muted">Transactions</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Summary Cards -->
<div class="row mb-4">
  <div class="col-md-12">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-receipt"></i> Transaction Summary</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-4 mb-3">
            <div class="d-flex justify-content-between align-items-center p-3 bg-light rounded">
              <div>
                <h6 class="text-muted mb-1">Total Transactions</h6>
                <h3 class="mb-0">{{ summary.transaction_count }}</h3>
              </div>
              <i class="fas fa-exchange-alt fa-2x text-primary opacity-25"></i>
            </div>
          </div>
          
          <div class="col-md-4 mb-3">
            <div class="d-flex justify-content-between align-items-center p-3 bg-light rounded">
              <div>
                <h6 class="text-muted mb-1">Failed Transactions</h6>
                <h3 class="mb-0 text-danger">{{ reconciliation.failed_count }}</h3>
              </div>
              <i class="fas fa-exclamation-triangle fa-2x text-danger opacity-25"></i>
            </div>
          </div>
          
          <div class="col-md-4 mb-3">
            <div class="d-flex justify-content-between align-items-center p-3 bg-light rounded">
              <div>
                <h6 class="text-muted mb-1">Net Position</h6>
                {% if summary.closing_balance >= 0 %}
                  <h3 class="mb-0 text-success">Rs. {{ "%.2f"|format(summary.closing_balance) }}</h3>
                {% else %}
                  <h3 class="mb-0 text-danger">Rs. {{ "%.2f"|format(summary.closing_balance) }}</h3>
                {% endif %}
              </div>
              <i class="fas fa-wallet fa-2x opacity-25"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Quick Actions -->
<div class="row mb-4">
  <div class="col-md-12">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-cogs"></i> Quick Actions</h5>
      </div>
      <div class="card-body">
        <a href="/bank/add-entry" class="btn btn-success">
          <i class="fas fa-plus-circle"></i> Add Manual Entry
        </a>
        <a href="/bank/statement" class="btn btn-primary">
          <i class="fas fa-list"></i> View Full Statement
        </a>
        <a href="/bank/reconciliation" class="btn btn-info">
          <i class="fas fa-tasks"></i> Reconciliation
        </a>
        <a href="/bank/export.csv" class="btn btn-success">
          <i class="fas fa-download"></i> Export CSV
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Pending Transactions Alert -->
{% if reconciliation.pending_count > 0 %}
<div class="alert alert-warning alert-dismissible fade show" role="alert">
  <i class="fas fa-exclamation-circle"></i> <strong>{{ reconciliation.pending_count }} pending transaction(s)</strong> 
  awaiting clearance. Total pending: Rs. {{ "%.2f"|format(reconciliation.total_pending) }}
  <a href="/bank/reconciliation" class="btn btn-sm btn-outline-warning">Review Pending</a>
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}

<!-- Failed Transactions Alert -->
{% if reconciliation.failed_count > 0 %}
<div class="alert alert-danger alert-dismissible fade show" role="alert">
  <i class="fas fa-times-circle"></i> <strong>{{ reconciliation.failed_count }} failed transaction(s)</strong> 
  require attention.
  <a href="/bank/reconciliation?status=failed" class="btn btn-sm btn-outline-danger">View Failed</a>
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}

<div class="mt-3">
  <a href="/" class="btn btn-outline-secondary"><i class="fas fa-home"></i> Back to Home</a>
</div>

{% endblock %}
