{% extends 'base.html' %}
{% block content %}
<h3>Add Supplier</h3>
<form method="post" action="/add_supplier" class="card p-3">
  <div class="mb-3">
    <label class="form-label">Name</label>
    <input class="form-control" name="name" required />
  </div>
  <div class="mb-3">
    <label class="form-label">Contact</label>
    <input class="form-control" name="contact" />
  </div>
  <button class="btn btn-primary" type="submit">Add</button>
</form>
<p class="mt-3"><a href="/">Back home</a></p>

{% if suppliers %}
<h4 class="mt-4">Existing Suppliers</h4>
<ul class="list-group">
  {% for s in suppliers %}
  <li class="list-group-item d-flex justify-content-between align-items-center">
    {{ s.name }} - {{ s.contact }}
    <form method="post" action="/supplier/delete" style="margin:0" onsubmit="return deleteSupplier(event, this)">
      <input type="hidden" name="supplier_id" value="{{ s.supplier_id }}" />
      <button class="btn btn-sm btn-outline-danger">Delete</button>
    </form>
  </li>
  {% endfor %}
</ul>
{% endif %}
<!-- Error Modal -->
<div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="errorModalLabel">Error</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="errorModalBody">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
async function deleteSupplier(event, form) {
    event.preventDefault();
    if (!confirm('Are you sure you want to delete this supplier?')) {
        return false;
    }
    
    try {
        const response = await fetch(form.action, {
            method: 'POST',
            body: new FormData(form)
        });
        
        const data = await response.json();
        
        if (!response.ok) {
            const errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
            document.getElementById('errorModalBody').textContent = data.detail || 'An error occurred';
            errorModal.show();
            return false;
        }
        
        // Success - refresh the page
        location.reload();
        
    } catch (error) {
        console.error('Error:', error);
        alert('An error occurred while deleting the supplier');
    }
    return false;
}
</script>
{% endblock %}